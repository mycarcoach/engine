(function() {
  var receivedData = {
    optimal: {
      "0": 34.0,
      "1": 33.8265306122,
      "2": 33.6530612245,
      "3": 33.4795918367,
      "4": 33.306122449,
      "5": 33.1326530612,
      "6": 32.9591836735,
      "7": 32.7857142857,
      "8": 32.612244898,
      "9": 32.4387755102,
      "10": 32.2653061224,
      "11": 32.0918367347,
      "12": 31.9183673469,
      "13": 31.7448979592,
      "14": 31.5714285714,
      "15": 31.3979591837,
      "16": 31.2244897959,
      "17": 31.0510204082,
      "18": 30.8775510204,
      "19": 30.7040816327,
      "20": 30.5306122449,
      "21": 30.3571428571,
      "22": 30.1836734694,
      "23": 30.0102040816,
      "24": 29.8367346939,
      "25": 29.6632653061,
      "26": 29.4897959184,
      "27": 29.3163265306,
      "28": 29.1428571429,
      "29": 28.9693877551,
      "30": 28.7959183673,
      "31": 28.6224489796,
      "32": 28.4489795918,
      "33": 28.2755102041,
      "34": 28.1020408163,
      "35": 27.9285714286,
      "36": 27.7551020408,
      "37": 27.5816326531,
      "38": 27.4081632653,
      "39": 27.2346938776,
      "40": 27.0612244898,
      "41": 26.887755102,
      "42": 26.7142857143,
      "43": 26.5408163265,
      "44": 26.3673469388,
      "45": 26.193877551,
      "46": 26.0204081633,
      "47": 25.8469387755,
      "48": 25.6734693878,
      "49": 25.5,
      "50": 25.3265306122,
      "51": 25.1530612245,
      "52": 24.9795918367,
      "53": 24.806122449,
      "54": 24.6326530612,
      "55": 24.4591836735,
      "56": 24.2857142857,
      "57": 24.112244898,
      "58": 23.9387755102,
      "59": 23.7653061224,
      "60": 23.5918367347,
      "61": 23.4183673469,
      "62": 23.2448979592,
      "63": 23.0714285714,
      "64": 22.8979591837,
      "65": 22.7244897959,
      "66": 22.5510204082,
      "67": 22.3775510204,
      "68": 22.2040816327,
      "69": 22.0306122449,
      "70": 21.8571428571,
      "71": 21.6836734694,
      "72": 21.5102040816,
      "73": 21.3367346939,
      "74": 21.1632653061,
      "75": 20.9897959184,
      "76": 20.8163265306,
      "77": 20.6428571429,
      "78": 20.4693877551,
      "79": 20.2959183673,
      "80": 20.1224489796,
      "81": 19.9489795918,
      "82": 19.7755102041,
      "83": 19.6020408163,
      "84": 19.4285714286,
      "85": 19.2551020408,
      "86": 19.0816326531,
      "87": 18.9081632653,
      "88": 18.7346938776,
      "89": 18.5612244898,
      "90": 18.387755102,
      "91": 18.2142857143,
      "92": 18.0408163265,
      "93": 17.8673469388,
      "94": 17.693877551,
      "95": 17.5204081633,
      "96": 17.3469387755,
      "97": 17.1734693878,
      "98": 17.0,
      "99": 16.8265306122,
      "100": 16.6530612245,
      "101": 16.4795918367,
      "102": 16.306122449,
      "103": 16.1326530612,
      "104": 15.9591836735,
      "105": 15.7857142857,
      "106": 15.612244898,
      "107": 15.4387755102,
      "108": 15.2653061224,
      "109": 15.0918367347,
      "110": 14.9183673469,
      "111": 14.7448979592,
      "112": 14.5714285714,
      "113": 14.3979591837,
      "114": 14.2244897959,
      "115": 14.0510204082,
      "116": 13.8775510204,
      "117": 13.7040816327,
      "118": 13.5306122449,
      "119": 13.3571428571,
      "120": 13.1836734694,
      "121": 13.0102040816,
      "122": 12.8367346939,
      "123": 12.6632653061,
      "124": 12.4897959184,
      "125": 12.3163265306,
      "126": 12.1428571429,
      "127": 11.9693877551,
      "128": 11.7959183673,
      "129": 11.6224489796,
      "130": 11.4489795918,
      "131": 11.2755102041,
      "132": 11.1020408163,
      "133": 10.9285714286,
      "134": 10.7551020408,
      "135": 10.5816326531,
      "136": 10.4081632653,
      "137": 10.2346938776,
      "138": 10.0612244898,
      "139": 9.887755102,
      "140": 9.7142857143,
      "141": 9.5408163265,
      "142": 9.3673469388,
      "143": 9.193877551,
      "144": 9.0204081633,
      "145": 8.8469387755,
      "146": 8.6734693878,
      "147": 8.5,
      "148": 8.3265306122,
      "149": 8.1530612245,
      "150": 7.9795918367,
      "151": 7.806122449,
      "152": 7.6326530612,
      "153": 7.4591836735,
      "154": 7.2857142857,
      "155": 7.112244898,
      "156": 6.9387755102,
      "157": 6.7653061224,
      "158": 6.5918367347,
      "159": 6.4183673469,
      "160": 6.2448979592,
      "161": 6.0714285714,
      "162": 5.8979591837,
      "163": 5.7244897959,
      "164": 5.5510204082,
      "165": 5.3775510204,
      "166": 5.2040816327,
      "167": 5.0306122449,
      "168": 4.8571428571,
      "169": 4.6836734694,
      "170": 4.5102040816,
      "171": 4.3367346939,
      "172": 4.1632653061,
      "173": 3.9897959184,
      "174": 3.8163265306,
      "175": 3.6428571429,
      "176": 3.4693877551,
      "177": 3.2959183673,
      "178": 3.1224489796,
      "179": 2.9489795918,
      "180": 2.7755102041,
      "181": 2.6020408163,
      "182": 2.4285714286,
      "183": 2.2551020408,
      "184": 2.0816326531,
      "185": 1.9081632653,
      "186": 1.7346938776,
      "187": 1.5612244898,
      "188": 1.387755102,
      "189": 1.2142857143,
      "190": 1.0408163265,
      "191": 0.8673469388,
      "192": 0.693877551,
      "193": 0.5204081633,
      "194": 0.3469387755,
      "195": 0.1734693878
    },
    actual: {
      "0": 35.5973560519,
      "1": 36.4807149478,
      "2": 34.6935282621,
      "3": 35.0287038397,
      "4": 34.1049043616,
      "5": 35.7704446139,
      "6": 34.7901868574,
      "7": 35.1511722189,
      "8": 35.3701516415,
      "9": 34.214301009,
      "10": 32.5058096673,
      "11": 33.7510780911,
      "12": 32.5156622595,
      "13": 34.7285919455,
      "14": 33.3343062086,
      "15": 31.8832027943,
      "16": 31.8986875148,
      "17": 32.3280242984,
      "18": 32.5146918027,
      "19": 31.2836998104,
      "20": 32.0015688837,
      "21": 31.487016299,
      "22": 30.234748438,
      "23": 32.8474340129,
      "24": 30.7847320431,
      "25": 30.0170671919,
      "26": 31.1884500394,
      "27": 31.9367345912,
      "28": 29.3382821541,
      "29": 29.0406637843,
      "30": 31.0912862479,
      "31": 31.2190556805,
      "32": 31.0094933366,
      "33": 28.3239000335,
      "34": 29.2365504139,
      "35": 30.8193047936,
      "36": 27.9476684735,
      "37": 28.511658247,
      "38": 29.5529098474,
      "39": 29.2503562424,
      "40": 28.0789916419,
      "41": 26.9587646436,
      "42": 28.2190162571,
      "43": 27.5960263931,
      "44": 27.1529426937,
      "45": 26.9843773287,
      "46": 28.8107039082,
      "47": 27.8676651823,
      "48": 25.9353500035,
      "49": 27.918658168,
      "50": 25.5254502038,
      "51": 27.6364104612,
      "52": 27.114012222,
      "53": 27.0070445639,
      "54": 27.2998720678,
      "55": 26.9548208868,
      "56": 24.3588905,
      "57": 24.8623532973,
      "58": 26.0873838312,
      "59": 26.2232954521,
      "60": 24.0218282587,
      "61": 24.6691488507,
      "62": 23.9655607245,
      "63": 23.7487438058,
      "64": 23.5927098843,
      "65": 23.0494321727,
      "66": 23.0492031742,
      "67": 23.179339858,
      "68": 23.9262682773,
      "69": 23.7602493554,
      "70": 24.3458469245,
      "71": 23.5167182793,
      "72": 23.6267632677,
      "73": 21.654340145,
      "74": 22.3611294766,
      "75": 23.5994000449,
      "76": 22.8705653179,
      "77": 22.7685814062,
      "78": 21.0928101571,
      "79": 22.745771689,
      "80": 20.7456156942,
      "81": 21.8338738745,
      "82": 22.2891670253,
      "83": 19.9558352099,
      "84": 21.1122416153,
      "85": 19.4505430954,
      "86": 21.4000233577,
      "87": 20.4428105577,
      "88": 21.1222205596,
      "89": 19.4188955913,
      "90": 18.7697630014,
      "91": 20.9738264889,
      "92": 19.0583486568,
      "93": 18.0754955757,
      "94": 20.1293831546,
      "95": 19.96134069,
      "96": 19.6687286913,
      "97": 18.8665103105,
      "98": 19.6285810237,
      "99": 17.0362060415,
      "100": 18.3071765647,
      "101": 18.8165064949,
      "102": 17.1597315524,
      "103": 16.5249015199,
      "104": 17.9225183855,
      "105": 18.1109824308,
      "106": 16.001476423,
      "107": 15.9649604893,
      "108": 16.2450458661,
      "109": 16.6980787226,
      "110": 17.7793370937,
      "111": 15.7060521063,
      "112": 16.2182159589,
      "113": 17.2389122263,
      "114": 14.2681323484,
      "115": 16.783677116,
      "116": 15.3487499038,
      "117": 15.1268718263,
      "118": 15.0426456513,
      "119": 13.8319039738,
      "120": 15.8312488137,
      "121": 15.2162592037,
      "122": 15.2622056341,
      "123": 14.8249494757,
      "124": 14.6225659572,
      "125": 13.6595221375,
      "126": 13.636574935,
      "127": 13.0886129539,
      "128": 14.1555298834,
      "129": 13.3136053257,
      "130": 11.9533340897,
      "131": 12.6892704637,
      "132": 11.1352989857,
      "133": 12.3366479075,
      "134": 11.0223793275,
      "135": 12.0574837203,
      "136": 13.3001451679,
      "137": 12.4266144397,
      "138": 12.2209667243,
      "139": 10.21020312,
      "140": 12.4742614302,
      "141": 12.035843246,
      "142": 11.5946693373,
      "143": 9.67465714,
      "144": 11.7459925264,
      "145": 10.3509198595,
      "146": 11.6526970099,
      "147": 10.7532371398,
      "148": 9.224536932,
      "149": 8.2386557465,
      "150": 10.0044160615,
      "151": 10.5393497618,
      "152": 7.8520729233,
      "153": 9.0004786133,
      "154": 7.3755677164,
      "155": 9.3051811399,
      "156": 9.3487681563,
      "157": 9.3047602716,
      "158": 8.8605996022,
      "159": 7.1127310287,
      "160": 8.3206980627,
      "161": 6.8740530504,
      "162": 7.577107166,
      "163": 6.7934932409,
      "164": 6.8869901331,
      "165": 6.7865782578,
      "166": 6.7299457027,
      "167": 6.6756143782,
      "168": 5.5269662558,
      "169": 5.5425336173,
      "170": 5.1721301653,
      "171": 5.9106204737,
      "172": 5.1369582633,
      "173": 5.2617024489,
      "174": 6.0734365295,
      "175": 4.229355258,
      "176": 3.6646669004,
      "177": 5.4166427049,
      "178": 5.6187305242,
      "179": 3.7905604603,
      "180": 2.8884341228,
      "181": 5.212309487,
      "182": 4.2751923811,
      "183": 4.8286904789,
      "184": 2.9112091891,
      "185": 4.2220464553,
      "186": 2.2980414179,
      "187": 3.159651024,
      "188": 4.1927364079,
      "189": 1.5277888358,
      "190": 2.0801838929,
      "191": 2.7367689939,
      "192": 2.5175863545,
      "193": 1.0239199957,
      "194": 1.1499705876,
      "195": 1.5254517591
    }
  };

  var optimalData = [];
  var actualData = [];
  var mockLabels = [];
  for (var i = 0; i < Object.keys(receivedData.optimal).length; i++) {
    optimalData.push(receivedData.optimal[i]);
    actualData.push(receivedData.actual[i]);
    mockLabels.push(i);
  }

  mockData = {
    optimal: optimalData,
    actual: actualData
  };

  // Data visualization
  var ctx = document.getElementById("speedChart");
  var config = {
    type: "line",
    data: {
      labels: mockLabels,
      datasets: [
        {
          label: "Actual",
          // backgroundColor: 'red',
          borderColor: "red",
          data: mockData.actual,
          fill: false
        },
        {
          label: "Optimal",
          fill: false,
          // backgroundColor: 'blue',
          borderColor: "blue",
          data: mockData.optimal
        }
      ]
    },
    options: {
      responsive: true,
      title: {
        display: true,
        text: "How close are you to the optimal braking curve?"
      },
      tooltips: {
        mode: "index",
        intersect: false
      },
      hover: {
        mode: "nearest",
        intersect: true
      },
      scales: {
        xAxes: [
          {
            display: true,
            scaleLabel: {
              display: true,
              labelString: "Time"
            }
          }
        ],
        yAxes: [
          {
            display: true,
            scaleLabel: {
              display: true,
              labelString: "Speed"
            }
          }
        ]
      }
    }
  };

  window.speedChart = new Chart(ctx, config);

  // Web Socket
  var ws = new WebSocket("ws://127.0.0.1:7254/");
  console.log("Websocket connect started!");
  ws.onmessage = function(event) {
    var data = JSON.parse(event.data);

    var optimalData = [];
    var actualData = [];
    var labels = [];
    for (var i = 0; i < Object.keys(data.optimal).length; i++) {
        labels.push(i);
        optimalData.push(data.optimal[i]);
        actualData.push(data.actual[i]);
    }

    var newActualDataset = {
      data: actualData,
      label: "Actual",
      borderColor: "red",
      fill: false
    };

    var newIdealDataset = {
      data: optimalData,
      label: "Optimal",
      borderColor: "blue",
      fill: false
    };

    config.data.labels = labels;
    config.data.datasets = [newActualDataset, newIdealDataset];
    window.speedChart.update();
  };
})();
